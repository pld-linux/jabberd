diff -durN jabberd-2.0b1.orig/tools/jabberd.in jabberd-2.0b1/tools/jabberd.in
--- jabberd-2.0b1.orig/tools/jabberd.in	Fri Sep 12 13:40:29 2003
+++ jabberd-2.0b1/tools/jabberd.in	Fri Sep 12 14:49:46 2003
@@ -15,6 +15,7 @@
 use IO::Select;
 use POSIX;
 use POSIX qw(setsid);
+use Proc::Daemon;

 #-----------------------------------------------------------------------------
 # Define some initial variables and default them as needed.
@@ -45,7 +46,24 @@
     &usage() if (!defined($opts{c}) || ($opts{c} eq ""));
 }
 
-$debug = 1 if exists($opts{D});
+if (exists($opts{D})) {
+       $debug = 1
+}
+else {
+       Proc::Daemon::Init;
+       open(PID,">/var/run/jabberd.pid");
+       print PID "$$\n";
+       close(PID);
+}
+
+if ($< == 0) {
+        my ($uid, $gid) = (getpwnam("jabber"))[2,3];
+        $)="$gid $gid" or die "Cannot set EGID and groups";
+        $(=$gid or die "Cannot set GID";;
+        $>=$uid or die "Cannot set EUID";
+        $<=$> or die "Cannot set UID";;
+}
+
 $daemon = 1 if exists($opts{b});
 
 #-----------------------------------------------------------------------------
