diff -durN jabberd-2.0b1.orig/tools/jabberd.in jabberd-2.0b1/tools/jabberd.in
--- jabberd-2.0b1.orig/tools/jabberd.in	Fri Sep 12 13:40:29 2003
+++ jabberd-2.0b1/tools/jabberd.in	Fri Sep 12 14:49:46 2003
@@ -12,7 +12,7 @@
 use FileHandle;
 use IPC::Open3;
 use IO::Select;
-
+use Proc::Daemon;
 
 $Bin="/usr/lib/jabberd"
 #-----------------------------------------------------------------------------
@@ -42,8 +42,23 @@
     &usage() if (!defined($opts{c}) || ($opts{c} eq ""));
 }
 
-$debug = 1 if exists($opts{D});
+if (exists($opts{D})) {
+	$debug = 1
+}
+else {
+	Proc::Daemon::Init;
+    	open(PID,">/var/run/jabberd.pid");
+	print PID "$$\n";
+	close(PID);
+}
 
+if ($< == 0) {
+        my ($uid, $gid) = (getpwnam("jabber"))[2,3];
+        $)="$gid $gid" or die "Cannot set EGID and groups";
+        $(=$gid or die "Cannot set GID";;
+        $>=$uid or die "Cannot set EUID";
+        $<=$> or die "Cannot set UID";;
+}
 
 #-----------------------------------------------------------------------------
 # Catch some signals so that we can handle them later.
